@using Models.EF;
@using Models.ModelsView;
@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    List<cPhieuMuonView> lst = ViewBag.lstPM;
}

<style>
    td a:hover {
        cursor: pointer;
    }
</style>
<section class="content-header">
    <h1>
        Danh sách
        <small>phiếu mượn</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="/Admin/Home/Index"><i class="fa fa-dashboard"></i> Home</a></li>
        <li><a href="#">Chức năng</a></li>
        <li class="active">Danh sách phiếu mượn</li>
    </ol>
</section>

<section class="content">
    <div class="row">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <div class="row" style="padding-right:10px; padding-left:10px">
                        <div class="col-md-3">
                            <a onclick="AddData()" class="btn btn-primary btn-flat">Thêm mới</a>
                        </div>
                        <div class="col-md-4">
                        </div>
                        <div class="col-md-5">
                            <div class="input-group">
                                <input type="text" id="txtSearch" placeholder="Nhập nội dung tìm kiếm ..." class="form-control" value="@ViewBag.Search" />
                                <span class="input-group-btn">
                                    <a class="btn btn-primary btn-flat" onclick="Search()">Tìm kiếm</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="box-body">
                    <table id="example1" class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>STT</th>
                                <th>MCB</th>
                                <th>Bạn đọc</th>
                                <th>Ngày mượn</th>
                                <th>Ngày hẹn trả</th>
                                <th>Ngày trả</th>
                                <th>Trạng thái</th>
                                <th>Chức năng</th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int stt = 0;
                                foreach (var item in lst)
                                {
                                    stt++;
                                    <tr>
                                        <td>@stt</td>
                                        <td>@item.MCB</td>
                                        <td>@item.BanDoc</td>
                                        <td>@item.NgayMuon.GetValueOrDefault().ToString("dd/MM/yyyy")</td>
                                        <td>@item.NgayHenTra.GetValueOrDefault().ToString("dd/MM/yyyy")</td>
                                        @if (item.NgayTra == null)
                                        {
                                            <td></td>
                                        }
                                        else
                                        {
                                            <td>@item.NgayTra.GetValueOrDefault().ToString("dd/MM/yyyy")</td>
                                        }
                                        @if (item.TrangThai == 1)
                                        {
                                            <td><span class="text-aqua">Đã trả</span></td>
                                        }
                                        else if (item.TrangThai == 2)
                                        {
                                            <td><span class="text-green">Chờ duyệt</span></td>
                                        }
                                        else if (item.TrangThai == 3)
                                        {
                                            <td><span class="text-yellow">Đang mượn</span></td>
                                        }
                                        else if (item.TrangThai == 4)
                                        {
                                            <td><span class="text-red">Quá hạn chưa trả</span></td>
                                        }
                                        <td>
                                            @*<a onclick="Edit(@item.ID)" style="padding-right:5px" title="Sửa"><i class="fa fa-pencil"></i></a>*@
                                            @if (item.TrangThai == 2)
                                            {
                                                <a onclick="Duyet(@item.ID, 3)" style="padding-right:5px" title="Duyệt cho mượn"><i class="fa fa-check"></i></a>
                                            }
                                            @if (item.TrangThai == 4 || item.TrangThai == 3)
                                            {
                                                <a onclick="AddDate(@item.ID)" style="padding-right:5px" title="Gia hạn"><i class="fa fa-clock-o"></i></a>
                                                <a onclick="Duyet(@item.ID, 1)" style="padding-right:5px" title="Trả ấn phẩm"><i class="fa fa-check"></i></a>
                                            }
                                            @if (item.TrangThai == 1)
                                            {
                                                <a onclick="DelData(@item.ID)" style="padding-right:5px" title="Xóa"><i class="fa fa-recycle"></i></a>
                                            }
                                        </td>
                                    </tr>
                                }
                            }
                    </table>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="mdDel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Xóa phiếu mượn</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row" style="padding-left:15px">
                    <input type="hidden" id="hdID_Del" value="0" />
                    Bạn có chắc chắn muốn xóa phiếu mượn này hay không?
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Đóng</button>
                <button type="button" onclick="Delete()" class="btn btn-primary">Đồng ý</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script src="~/assets/admin/js/coupon.js"></script>
    <script>
        $(document).ready(function () {
            $('.treeview').removeClass('active');
            $('#liChucNang').addClass('active');
        });
        $(function () {
            $('input[type="checkbox"].minimal-red, input[type="radio"].minimal-red').iCheck({
                checkboxClass: 'icheckbox_minimal-red',
                radioClass: 'iradio_minimal-red'
            });
        })
    </script>
}